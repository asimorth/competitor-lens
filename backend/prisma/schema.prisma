// Prisma Schema - Supports both local and production

generator client {
  provider = "prisma-client-js"
  // No previewFeatures needed for basic operations
}

// Database connection
// LOCAL: Use same URL for both (standard PostgreSQL)
// PRODUCTION: DATABASE_URL = Prisma Accelerate, DIRECT_DATABASE_URL = Direct connection
datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_DATABASE_URL")
}

model Competitor {
  id          String              @id @default(uuid())
  name        String              @unique
  logoUrl     String?             @map("logo_url")
  website     String?
  description String?
  industry    String?
  region      String?             // TR, Global, EU, US, etc.
  features    CompetitorFeature[]
  createdAt   DateTime            @default(now()) @map("created_at")
  updatedAt   DateTime            @updatedAt @map("updated_at")

  @@map("competitors")
}

model Feature {
  id          String              @id @default(uuid())
  name        String              @unique
  category    String?
  description String?
  priority    String?             // high, medium, low
  competitors CompetitorFeature[]
  createdAt   DateTime            @default(now()) @map("created_at")
  updatedAt   DateTime            @updatedAt @map("updated_at")

  @@map("features")
}

model CompetitorFeature {
  id                    String                         @id @default(uuid())
  competitorId          String                         @map("competitor_id")
  featureId             String                         @map("feature_id")
  hasFeature            Boolean                        @default(false) @map("has_feature")
  implementationQuality String?                        @map("implementation_quality") // excellent, good, basic, none
  notes                 String?
  screenshots           CompetitorFeatureScreenshot[]
  competitor            Competitor                     @relation(fields: [competitorId], references: [id], onDelete: Cascade)
  feature               Feature                        @relation(fields: [featureId], references: [id], onDelete: Cascade)
  createdAt             DateTime                       @default(now()) @map("created_at")
  updatedAt             DateTime                       @updatedAt @map("updated_at")

  @@unique([competitorId, featureId])
  @@map("competitor_features")
}

model CompetitorFeatureScreenshot {
  id                  String            @id @default(uuid())
  competitorFeatureId String            @map("competitor_feature_id")
  screenshotPath      String            @map("screenshot_path")
  caption             String?
  displayOrder        Int?              @map("display_order")
  competitorFeature   CompetitorFeature @relation(fields: [competitorFeatureId], references: [id], onDelete: Cascade)
  createdAt           DateTime          @default(now()) @map("created_at")

  @@map("competitor_feature_screenshots")
}

// Existing models for supporting features
model Upload {
  id           String   @id @default(uuid())
  filename     String
  originalName String   @map("original_name")
  fileType     String   @map("file_type") // pdf, png, excel
  fileSize     BigInt   @map("file_size")
  storageUrl   String   @map("storage_url")
  uploadedBy   String?  @map("uploaded_by") // user_id
  metadata     Json?
  createdAt    DateTime @default(now()) @map("created_at")

  @@map("uploads")
}

model Report {
  id          String   @id @default(uuid())
  title       String
  description String?
  reportType  String   @map("report_type") // heatmap, gap_analysis, feature_matrix
  config      Json?    // Rapor konfigürasyonu
  createdBy   String?  @map("created_by")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  @@map("reports")
}

model User {
  id        String    @id @default(uuid())
  email     String    @unique
  name      String
  role      String    @default("viewer") // admin, editor, viewer
  avatarUrl String?   @map("avatar_url")
  createdAt DateTime  @default(now()) @map("created_at")
  lastLogin DateTime? @map("last_login")

  @@map("users")
}

model BenchmarkArchive {
  id               String   @id @default(uuid())
  title            String
  snapshotDate     DateTime @map("snapshot_date")
  data             Json     // Anlık veri snapshot'u
  competitorsCount Int?     @map("competitors_count")
  featuresCount    Int?     @map("features_count")
  createdBy        String?  @map("created_by")
  createdAt        DateTime @default(now()) @map("created_at")

  @@map("benchmark_archives")
}
